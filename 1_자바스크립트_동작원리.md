# 20190117_자바스크립트의_동작원리  

## 스레드란?
CPU 이용의 기본 단위로, 스레드 ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성된다. 같은 프로세스에 속한 스레드들끼리는 코드, 데이터, 파일 등을 공유한다.

### 싱글 스레드
하나의 프로세스에서 하나의 스레드를 이용하는 것이다. 스레드가 하나이기 때문에 단 하나의 스택을 가지는 것이므로 한 번에 하나의 일만 처리할 수 있다. JS는 싱글 스레드 언어이다.

### 멀티 스레드
싱글 스레드와 반대로 하나의 프로세스에서 여러 가지의 스레드를 이용하는 것이다. 멀티 스레드를 통해 자원을 공유하며 각각의 스레드는 고유의 레지스터와 스택을 갖는다. 새로운 프로세스를 생성하는 것보다 프로세스 내에서 스레드를 생성하는 것이 속도 면에서도 빠르며, 자원과 상태를 공유하기 때문에 효율적인 운영이 가능하지만, 너무 많은 스레드를 사용하거나 잦은 컨덱스트 스위칭은 성능 저하를 일으킬 수 있으며, 한 스레드에서 문제가 발생하면 해당 프로세스 전체에 영향을 끼친다.

## 자바스크립트 엔진
자바스크립트의 대표적인 예, Google V8는 Chrome과 Node.js에서 사용된다. 엔진의 주요 구성요소는 메모리힙과 콜스택 그리고 이벤트 큐로 이루어 진다. 메모리힙은 메모리 할당이 일어나는 곳이고, 콜스택은 실행 흐름에 따라 호출 스택이 쌓이는 즉, 코드 실행 위치를 나타낸다.

### 메모리힙 (Memory Heap)
앞서 언급했듯이, 메모리 힙은 메모리 할당이 일어나는 곳이다. 동적으로 생성된 인스턴스는 이 힙에 할당된다.

### 콜스택 (Call Stack)
자바스크립트는 단일스레드 프로그래밍 언어로, 콜스택을 하나만 갖는다. 함수를 호출하는 순간 콜스택에 push 되는 것이고, 반환 시에 pop 되는 것이다.

## 이벤트 루프 (Event Loop)
처리할 task들을 저장하는 대기 큐가 존재한다. 그 큐를 Event Queue 또는 Task Queue라고 한다. task들이 저장된 큐는 콜스택이 모두 비워진 후에 차례대로 수행한다. 일반적인 함수들은 콜스택에서 push, pop 되며 실행되지만, 비동기로 호출되는 Web API 영역에 정의된 함수들은 콜스택이 아닌 Event Queue에 enqueue 된다.  
이벤트 루프는 대기하고 있다가 콜 스택이 비었을 때, 큐의 첫 번째 이벤트부터 차례대로 콜스택에 push 하는 역할을 한다. 이후 콜스택에 들어간 이벤트는 앞서 진행되었던 대로 진행된다. 이러한 반복을 이벤트 루프에서는 틱(tick)이라 부른다.

